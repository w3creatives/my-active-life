import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import type { SharedData } from '@/types';
import { usePage } from '@inertiajs/react';
import axios from 'axios';
import { useEffect, useRef, useState } from 'react';

interface VisualProgressMapProps {
  totalPoints: number;
  goal: number;
  title?: string;
}

interface VisualProgressData {
  progress_percentage: number;
  distance: number;
}

export default function VisualProgressMap({ totalPoints, goal, title }: VisualProgressMapProps) {
  const { auth } = usePage<SharedData>().props;
  const mapRef = useRef<HTMLDivElement>(null);
  const [visualProgress, setVisualProgress] = useState<VisualProgressData | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchVisualProgress = async () => {
      try {
        // Fetch visual progress data similar to Ruby gon.visual_progress
        const response = await axios.get(route('userstats', ['visual-progress']), {
          params: {
            event_id: auth.preferred_event.id,
            user_id: auth.user.id,
          },
        });
        setVisualProgress(response.data);
      } catch (error) {
        console.error('Error fetching visual progress:', error);
        // Fallback to calculating progress from totalPoints and goal
        setVisualProgress({
          progress_percentage: goal > 0 ? (totalPoints / goal) * 100 : 0,
          distance: totalPoints,
        });
      } finally {
        setLoading(false);
      }
    };

    fetchVisualProgress();
  }, [totalPoints, goal, auth.preferred_event.id, auth.user.id]);

  useEffect(() => {
    if (!visualProgress || loading || !mapRef.current) return;

    const setMapFill = (percentage: number, miles: number) => {
      const distance = percentage * 9.59; // Convert percentage to distance (from Ruby code)
      
      // Update mile count display
      const mileCountElement = mapRef.current?.querySelector('.mileCount');
      if (mileCountElement) {
        mileCountElement.textContent = miles.toFixed(1);
      }

      // Animate the map mask
      const mapMask = mapRef.current?.querySelector('#map-mask') as SVGElement;
      if (mapMask) {
        // Simple animation to move the mask
        let currentDistance = 0;
        const targetDistance = distance;
        const steps = 60; // 60 FPS
        const increment = (targetDistance - currentDistance) / steps;

        const animate = () => {
          currentDistance += increment;
          if (currentDistance >= targetDistance) {
            currentDistance = targetDistance;
          }
          
          mapMask.setAttribute('x', currentDistance.toString());
          
          if (currentDistance < targetDistance) {
            requestAnimationFrame(animate);
          }
        };
        
        requestAnimationFrame(animate);
      }
    };

    setMapFill(visualProgress.progress_percentage, visualProgress.distance);
  }, [visualProgress, loading]);

  const formatDistance = (distance: number) => {
    return new Intl.NumberFormat('en-US', {
      minimumFractionDigits: 0,
      maximumFractionDigits: 1,
    }).format(distance);
  };

  if (loading) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="text-xl">{title || 'Your Progress'}</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="animate-pulse space-y-4">
            <div className="h-4 bg-muted rounded w-1/2 mx-auto"></div>
            <div className="h-64 bg-muted rounded"></div>
            <div className="h-4 bg-muted rounded w-3/4 mx-auto"></div>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-xl">{title || 'Your Progress'}</CardTitle>
      </CardHeader>
      <CardContent>
        <div id="visual-progress__map" ref={mapRef} className="relative">
          {/* SVG Map of USA based on Ruby implementation */}
          <svg
            viewBox="0 0 959 593"
            className="w-full h-auto max-h-64"
            xmlns="http://www.w3.org/2000/svg"
          >
            <defs>
              <mask id="progress-mask">
                <rect width="100%" height="100%" fill="white" />
                <rect id="map-mask" x="0" y="0" width="100%" height="100%" fill="black" />
              </mask>
            </defs>
            
            {/* USA Map Path - Simplified version for progress visualization */}
            <path
              d="M844 206c2 3 4 3 6 1l1-2c4-6 8-12 15-15l5-2c8-3 15-8 25-8 4 0 8 1 12 3l7 4c6 4 13 6 20 4 4-1 7-3 10-6l2-2c3-4 7-7 12-8 4-1 8 0 11 2l6 4c4 3 9 4 14 3l8-2c5-2 11-2 16 0l4 1c6 2 12 1 17-2l4-2c5-3 11-4 17-3l5 1c6 1 12-1 17-4l3-2c4-3 9-4 14-4h5c5 0 10 2 14 5l3 2c4 3 9 4 14 4h6c5 0 10-2 14-5l2-2c3-3 7-5 12-6l4-1c5-1 10 0 14 3l3 2c3 3 7 5 12 6l4 1c5 1 10-1 14-4l2-2c3-3 8-5 13-5h4c5 0 10 2 13 6l2 3c2 4 6 7 11 8l4 1c5 1 10-1 14-4l2-2c3-3 8-4 13-4h4c5 0 9 2 12 5l2 3c2 3 5 6 9 7l4 1c4 1 8 0 11-2l2-1c3-2 7-3 11-3h3c4 0 8 1 11 4l2 2c2 3 5 5 9 6l3 1c4 1 7 0 10-2l1-1c2-2 5-3 8-3h2c3 0 6 1 8 3l1 1c1 2 3 4 6 5l2 1c3 1 6 1 9-1l1-1c2-1 4-2 7-2h2c3 0 5 1 7 3l1 1c1 2 2 4 4 5l2 2c2 1 5 2 8 1l2-1c2-1 4-1 6-1h2c2 0 4 1 6 2l1 1c1 1 2 3 2 5v2c0 2-1 4-3 5l-1 1c-2 1-4 3-5 6l-1 2c-1 3-1 6 1 9l1 2c1 2 3 4 6 5l2 1c3 1 6 1 9-1l2-1c2-1 5-1 7 0l2 1c2 1 3 3 4 5l1 2c1 3 0 6-2 8l-1 2c-2 2-3 5-3 8v2c0 3 1 6 4 8l2 1c3 2 6 2 9 1l2-1c2-1 5-1 7 1l2 1c2 2 3 4 3 7v2c0 3-1 5-3 7l-1 1c-2 2-4 5-4 8v2c0 3 1 6 3 8l1 2c2 2 5 3 8 3h2c3 0 6-1 8-3l1-1c2-2 5-3 8-2l2 1c3 1 5 3 6 6l1 2c1 3 0 7-2 9l-1 2c-2 2-3 5-3 8v2c0 3 2 6 5 7l2 1c3 1 7 1 10-1l2-1c3-2 6-2 9-1l2 1c3 1 5 4 5 7v2c0 3-1 6-4 8l-2 1c-3 2-5 5-5 9v2c0 4 2 7 5 9l2 1c3 2 7 2 10 0l2-1c3-2 7-2 10 0l2 1c3 2 4 5 4 8v2c0 3-1 6-4 8l-2 1c-3 2-5 6-4 9l1 2c1 3 4 5 7 6l2 1c3 1 7 0 10-2l2-1c3-2 7-2 10 1l2 1c2 2 3 5 3 8v2c0 3-2 6-5 8l-2 1c-3 2-6 5-6 9v2c0 4 2 7 6 9l2 1c4 2 8 2 12 0l2-1c4-2 8-1 11 1l2 1c3 2 4 6 4 9v2c0 3-2 6-5 8l-2 1c-3 2-6 6-6 10v2c0 4 3 7 6 9l2 1c4 2 8 1 11-1l2-1c3-2 7-2 11 0l2 1c3 2 5 5 5 9v2c0 4-2 7-5 9l-2 1c-3 2-6 5-6 9v2c0 4 2 8 6 10l2 1c4 2 8 2 12-1l2-1c4-3 9-3 13 0l2 1c4 3 6 7 5 11l-1 2c-1 4-4 7-8 9l-2 1c-4 2-7 6-7 11v2c0 5 3 9 7 11l2 1c4 2 8 5 8 10v2c0 5-3 9-8 11l-2 1c-5 2-8 7-8 12v2c0 5 4 9 8 11l2 1c4 2 7 6 7 11v2c0 5-3 9-7 11l-2 1c-4 2-8 6-7 11l1 2c1 5 5 8 10 9l2 1c5 1 9 5 10 10l1 2c1 5-1 10-5 13l-2 2c-4 3-7 8-7 13v2c0 5 3 10 7 13l2 2c4 3 6 8 5 13l-1 2c-1 5-5 9-10 10l-2 1c-5 1-9 5-10 10l-1 2c-1 5 1 10 5 13l2 2c4 3 6 8 5 13l-1 2c-1 5-5 8-10 9l-2 1c-5 1-9 6-9 11v2c0 5 4 9 9 11l2 1c5 1 9 4 10 9l1 2c1 5-1 10-5 13l-2 2c-4 3-6 8-5 13l1 2c1 5 5 8 10 9l2 1c5 1 8 6 8 11v2c0 5-3 10-8 12l-2 1c-5 2-8 7-8 12v2c0 5 3 9 8 11l2 1c5 2 8 7 7 12l-1 2c-1 5-6 9-11 10l-2 1c-5 1-10 5-11 11l-1 2c-1 6 2 11 7 14l2 2c5 3 7 9 6 14l-1 3c-1 5-6 9-11 10l-3 1c-5 1-10 6-10 12v2c0 6 4 11 10 13l3 1c5 2 9 7 9 12v3c0 5-4 10-9 12l-3 1c-5 2-9 7-9 13v2c0 6 4 11 9 13l3 1c5 2 8 7 8 12v3c0 5-3 10-8 12l-3 1c-5 2-9 7-8 13l1 2c1 6 6 10 12 11l3 1c6 1 11 6 12 12l1 3c1 6-2 12-7 15l-3 2c-5 3-8 9-8 15v3c0 6 3 11 8 14l3 2c5 3 8 9 7 15l-1 3c-1 6-6 11-12 12l-3 1c-6 1-11 6-12 12l-1 3c-1 6 2 12 8 15l3 2c6 3 9 10 8 16l-1 3c-1 6-7 11-13 12l-3 1c-6 1-12 6-13 13l-1 3c-1 7 3 13 9 16l3 2c6 3 10 10 9 17l-1 3c-1 7-7 12-14 13l-3 1c-7 1-13 7-14 14l-1 3c-1 7 3 14 9 17l3 2c6 3 10 11 9 18l-1 3c-1 7-8 12-15 13l-3 1c-7 1-13 7-14 15l-1 3c-1 8 3 15 10 18l3 2c7 3 11 11 10 19l-1 4c-1 8-8 13-16 14l-4 1c-8 1-14 8-15 16l-1 4c-1 8 4 16 11 19l4 2c8 3 12 12 11 20l-1 4c-1 8-9 14-17 15l-4 1c-8 1-15 8-16 16l-1 4c-1 9 4 17 12 20l4 2c8 3 13 12 12 21l-1 4c-1 9-9 15-18 16l-4 1c-9 1-16 9-17 18l-1 4c-1 9 5 18 13 21l4 2c9 3 14 13 13 22l-1 4c-1 9-10 16-19 17l-4 1c-9 1-17 9-18 18l-1 4c-1 10 5 19 14 22l4 2c9 4 15 14 14 23l-1 5c-1 9-11 16-20 17l-5 1c-9 1-18 10-19 19l-1 5c-1 10 6 20 15 23l5 2c10 4 16 15 15 25l-1 5c-1 10-11 17-21 18l-5 1c-10 1-19 10-20 20l-1 5c-1 11 6 21 16 24l5 2c10 4 17 15 16 26l-1 5c-1 10-12 18-22 19l-5 1c-10 1-20 11-21 21l-1 5c-1 11 7 22 17 25l5 2c11 4 18 16 17 27l-1 5c-1 11-12 19-23 20l-5 1c-11 1-21 11-22 22l-1 5c-1 12 7 23 18 26l5 2c11 4 19 17 18 28l-1 6c-1 11-13 20-24 21l-6 1c-11 1-22 12-23 23l-1 6c-1 12 8 24 19 27l6 2c12 4 20 17 19 29l-1 6c-1 12-14 21-25 22l-6 1c-12 1-23 12-24 24l-1 6c-1 13 8 25 20 28l6 2c12 4 21 18 20 30l-1 6c-1 12-14 22-26 23l-6 1c-12 1-24 13-25 25l-1 6c-1 13 9 26 21 29l6 2c13 4 22 19 21 31l-1 6c-1 13-15 23-27 24l-6 1c-13 1-25 13-26 26l-1 6c-1 14 9 27 22 30l6 2c13 4 23 20 22 32l-1 7c-1 13-16 24-28 25l-7 1c-13 1-26 14-27 27l-1 7c-1 14 10 28 23 31l7 2c14 4 24 20 23 33l-1 7c-1 14-16 25-29 26l-7 1c-14 1-27 14-28 28l-1 7c-1 15 10 29 24 32l7 2c14 4 25 21 24 34l-1 7c-1 14-17 26-30 27l-7 1c-14 1-28 15-29 29l-1 7c-1 15 11 30 25 33l7 2c15 4 26 22 25 35l-1 7c-1 15-18 27-31 28l-7 1c-15 1-29 15-30 30l-1 7c-1 16 11 31 26 34l7 2c15 4 27 23 26 36l-1 8c-1 15-18 28-32 29l-8 1c-15 1-30 16-31 31l-1 8c-1 16 12 32 27 35l8 2c16 4 28 23 27 37l-1 8c-1 16-19 29-33 30l-8 1c-16 1-31 16-32 32l-1 8c-1 17 12 33 28 36l8 2c16 4 29 24 28 38l-1 8c-1 16-20 30-34 31l-8 1c-16 1-32 17-33 33l-1 8c-1 17 13 34 29 37l8 2c17 4 30 25 29 39l-1 9c-1 17-21 31-35 32l-9 1c-17 1-33 17-34 34l-1 9c-1 18 13 35 30 38l9 2c17 4 31 26 30 40l-1 9c-1 17-22 32-36 33l-9 1c-17 1-34 18-35 35l-1 9c-1 18 14 36 31 39l9 2c18 4 32 26 31 41l-1 9c-1 18-22 33-37 34l-9 1c-18 1-35 18-36 36l-1 9c-1 19 14 37 32 40l9 2c18 4 33 27 32 42l-1 10c-1 18-23 34-38 35l-10 1c-18 1-36 19-37 37l-1 10c-1 19 15 38 33 41l10 2c19 4 34 28 33 43l-1 10c-1 19-24 35-39 36l-10 1c-19 1-37 19-38 38l-1 10c-1 20 15 39 34 42l10 2c19 4 35 29 34 44l-1 10c-1 19-25 36-40 37l-10 1c-19 1-38 20-39 39l-1 10c-1 20 16 40 35 43l10 2c20 4 36 30 35 45l-1 11c-1 20-26 37-41 38l-11 1c-20 1-39 20-40 40l-1 11c-1 21 16 41 36 44l11 2c20 4 37 31 36 46l-1 11c-1 20-27 38-42 39l-11 1c-20 1-40 21-41 41l-1 11c-1 21 17 42 37 45l11 2c21 4 38 32 37 47l-1 11c-1 21-28 39-43 40l-11 1c-21 1-41 21-42 42l-1 11c-1 22 17 43 38 46l11 2c21 4 39 33 38 48l-1 12c-1 21-29 40-44 41l-12 1c-21 1-42 22-43 43l-1 12c-1 22 18 44 39 47l12 2c22 4 40 34 39 49l-1 12c-1 22-30 41-45 42l-12 1c-22 1-43 22-44 44l-1 12c-1 23 18 45 40 48l12 2c22 4 41 35 40 50l-1 12c-1 22-31 42-46 43l-12 1c-22 1-44 23-45 45l-1 12c-1 23 19 46 41 49l12 2c23 4 42 36 41 51l-1 13c-1 23-32 43-47 44l-13 1c-23 1-45 23-46 46l-1 13c-1 24 19 47 42 50l13 2c23 4 43 37 42 52l-1 13c-1 23-33 44-48 45l-13 1c-23 1-46 24-47 47l-1 13c-1 24 20 48 43 51l13 2c24 4 44 38 43 53l-1 13c-1 24-34 45-49 46l-13 1c-24 1-47 24-48 48l-1 13c-1 25 20 49 44 52l13 2c24 4 45 39 44 54l-1 14c-1 24-35 46-50 47l-14 1c-24 1-48 25-49 49l-1 14c-1 25 21 50 45 53l14 2c25 4 46 40 45 55l-1 14c-1 25-36 47-51 48l-14 1c-25 1-49 25-50 50l-1 14c-1 26 21 51 46 54l14 2c25 4 47 41 46 56l-1 14c-1 25-37 48-52 49l-14 1c-25 1-50 26-51 51l-1 14c-1 26 22 52 47 55l14 2c26 4 48 42 47 57l-1 15c-1 26-38 49-53 50l-15 1c-26 1-51 26-52 52l-1 15c-1 27 22 53 48 56l15 2c26 4 49 43 48 58l-1 15c-1 26-39 50-54 51l-15 1c-26 1-52 27-53 53l-1 15c-1 27 23 54 49 57l15 2c27 4 50 44 49 59l-1 15c-1 27-40 51-55 52l-15 1c-27 1-53 27-54 54l-1 15c-1 28 23 55 50 58l15 2c27 4 51 45 50 60l-1 16c-1 27-41 52-56 53l-16 1c-27 1-54 28-55 55l-1 16c-1 28 24 56 51 59l16 2c28 4 52 46 51 61l-1 16c-1 28-42 53-57 54l-16 1c-28 1-55 28-56 56l-1 16c-1 29 24 57 52 60l16 2c28 4 53 47 52 62l-1 16c-1 28-43 54-58 55l-16 1c-28 1-56 29-57 57l-1 16c-1 29 25 58 53 61l16 2c29 4 54 48 53 63l-1 17c-1 29-44 55-59 56l-17 1c-29 1-57 29-58 58l-1 17c-1 30 25 59 54 62l17 2c29 4 55 49 54 64l-1 17c-1 29-45 56-60 57l-17 1c-29 1-58 30-59 59l-1 17c-1 30 26 60 55 63l17 2c30 4 56 50 55 65l-1 17c-1 30-46 57-61 58l-17 1c-30 1-59 30-60 60l-1 17c-1 31 26 61 56 64l17 2c30 4 57 51 56 66l-1 18c-1 30-47 58-62 59l-18 1c-30 1-60 31-61 61l-1 18c-1 31 27 62 57 65l18 2c31 4 58 52 57 67l-1 18c-1 31-48 59-63 60l-18 1c-31 1-61 31-62 62l-1 18c-1 32 27 63 58 66l18 2c31 4 59 53 58 68l-1 18c-1 31-49 60-64 61l-18 1c-31 1-62 32-63 63l-1 18c-1 32 28 64 59 67l18 2c32 4 60 54 59 69l-1 19c-1 32-50 61-65 62l-19 1c-32 1-63 32-64 64l-1 19c-1 33 28 65 60 68l19 2c32 4 61 55 60 70l-1 19c-1 32-51 62-66 63l-19 1c-32 1-64 33-65 65l-1 19c-1 33 29 66 61 69l19 2c33 4 62 56 61 71l-1 19c-1 33-52 63-67 64l-19 1c-33 1-65 33-66 66l-1 19c-1 34 29 67 62 70l19 2c33 4 63 57 62 72l-1 20c-1 33-53 64-68 65l-20 1c-33 1-66 34-67 67l-1 20c-1 34 30 68 63 71l20 2c34 4 64 58 63 73l-1 20c-1 34-54 65-69 66l-20 1c-34 1-67 34-68 68l-1 20c-1 35 30 69 64 72l20 2c34 4 65 59 64 74l-1 20c-1 34-55 66-70 67l-20 1c-34 1-68 35-69 69l-1 20c-1 35 31 70 65 73l20 2c35 4 66 60 65 75l-1 21c-1 35-56 67-71 68l-21 1c-35 1-69 35-70 70l-1 21c-1 36 31 71 66 74l21 2c35 4 67 61 66 76l-1 21c-1 35-57 68-72 69l-21 1c-35 1-70 36-71 71l-1 21c-1 36 32 72 67 75l21 2c36 4 68 62 67 77l-1 21c-1 36-58 69-73 70l-21 1c-36 1-71 36-72 72l-1 21c-1 37 32 73 68 76l21 2c36 4 69 63 68 78l-1 22c-1 36-59 70-74 71l-22 1c-36 1-72 37-73 73l-1 22c-1 37 33 74 69 77l22 2c37 4 70 64 69 79l-1 22c-1 37-60 71-75 72l-22 1c-37 1-73 37-74 74l-1 22c-1 38 33 75 70 78l22 2c37 4 71 65 70 80l-1 22c-1 37-61 72-76 73l-22 1c-37 1-74 38-75 75l-1 22c-1 38 34 76 71 79l22 2c38 4 72 66 71 81l-1 23c-1 38-62 73-77 74l-23 1c-38 1-75 38-76 76l-1 23c-1 39 34 77 72 80l23 2c38 4 73 67 72 82l-1 23c-1 38-63 74-78 75l-23 1c-38 1-76 39-77 77l-1 23c-1 39 35 78 73 81l23 2c39 4 74 68 73 83l-1 23c-1 39-64 75-79 76l-23 1c-39 1-77 39-78 78l-1 23c-1 40 35 79 74 82l23 2c39 4 75 69 74 84l-1 24c-1 39-65 76-80 77l-24 1c-39 1-78 40-79 79l-1 24c-1 40 36 80 75 83l24 2c40 4 76 70 75 85l-1 24c-1 40-66 77-81 78l-24 1c-40 1-79 40-80 80l-1 24"
              fill="currentColor"
              className="text-blue-200"
              mask="url(#progress-mask)"
            />
            
            {/* Progress overlay - this gets revealed as progress increases */}
            <path
              d="M844 206c2 3 4 3 6 1l1-2c4-6 8-12 15-15l5-2c8-3 15-8 25-8 4 0 8 1 12 3l7 4c6 4 13 6 20 4 4-1 7-3 10-6l2-2c3-4 7-7 12-8 4-1 8 0 11 2l6 4c4 3 9 4 14 3l8-2c5-2 11-2 16 0l4 1c6 2 12 1 17-2l4-2c5-3 11-4 17-3l5 1c6 1 12-1 17-4l3-2c4-3 9-4 14-4h5c5 0 10 2 14 5l3 2c4 3 9 4 14 4h6c5 0 10-2 14-5l2-2c3-3 7-5 12-6l4-1c5-1 10 0 14 3l3 2c3 3 7 5 12 6l4 1c5 1 10-1 14-4l2-2c3-3 8-5 13-5h4c5 0 10 2 13 6l2 3c2 4 6 7 11 8l4 1c5 1 10-1 14-4l2-2c3-3 8-4 13-4h4c5 0 9 2 12 5l2 3c2 3 5 6 9 7l4 1c4 1 8 0 11-2l2-1c3-2 7-3 11-3h3c4 0 8 1 11 4l2 2c2 3 5 5 9 6l3 1c4 1 7 0 10-2l1-1c2-2 5-3 8-3h2c3 0 6 1 8 3l1 1c1 2 3 4 6 5l2 1c3 1 6 1 9-1l1-1c2-1 4-2 7-2h2c3 0 5 1 7 3l1 1c1 2 2 4 4 5l2 2c2 1 5 2 8 1l2-1c2-1 4-1 6-1h2c2 0 4 1 6 2l1 1c1 1 2 3 2 5v2c0 2-1 4-3 5l-1 1c-2 1-4 3-5 6l-1 2c-1 3-1 6 1 9l1 2c1 2 3 4 6 5l2 1c3 1 6 1 9-1l2-1c2-1 5-1 7 0l2 1c2 1 3 3 4 5l1 2c1 3 0 6-2 8l-1 2c-2 2-3 5-3 8v2c0 3 1 6 4 8l2 1c3 2 6 2 9 1l2-1c2-1 5-1 7 1l2 1c2 2 3 4 3 7v2c0 3-1 5-3 7l-1 1c-2 2-4 5-4 8v2c0 3 1 6 3 8l1 2c2 2 5 3 8 3h2c3 0 6-1 8-3l1-1c2-2 5-3 8-2l2 1c3 1 5 3 6 6l1 2c1 3 0 7-2 9l-1 2c-2 2-3 5-3 8v2c0 3 2 6 5 7l2 1c3 1 7 1 10-1l2-1c3-2 6-2 9-1l2 1c3 1 5 4 5 7v2c0 3-1 6-4 8l-2 1c-3 2-5 5-5 9v2c0 4 2 7 5 9l2 1c3 2 7 2 10 0l2-1c3-2 7-2 10 0l2 1c3 2 4 5 4 8v2c0 3-1 6-4 8l-2 1c-3 2-5 6-4 9l1 2c1 3 4 5 7 6l2 1c3 1 7 0 10-2l2-1c3-2 7-2 10 1l2 1c2 2 3 5 3 8v2c0 3-2 6-5 8l-2 1c-3 2-6 5-6 9v2c0 4 2 7 6 9l2 1c4 2 8 2 12 0l2-1c4-2 8-1 11 1l2 1c3 2 4 6 4 9v2c0 3-2 6-5 8l-2 1c-3 2-6 6-6 10v2c0 4 3 7 6 9l2 1c4 2 8 1 11-1l2-1c3-2 7-2 11 0l2 1c3 2 5 5 5 9v2c0 4-2 7-5 9l-2 1c-3 2-6 5-6 9v2c0 4 2 8 6 10l2 1c4 2 8 2 12-1l2-1c4-3 9-3 13 0l2 1c4 3 6 7 5 11l-1 2c-1 4-4 7-8 9l-2 1c-4 2-7 6-7 11v2c0 5 3 9 7 11l2 1c4 2 8 5 8 10v2c0 5-3 9-8 11l-2 1c-5 2-8 7-8 12v2c0 5 4 9 8 11l2 1c4 2 7 6 7 11v2c0 5-3 9-7 11l-2 1c-4 2-8 6-7 11l1 2c1 5 5 8 10 9l2 1c5 1 9 5 10 10l1 2c1 5-1 10-5 13l-2 2c-4 3-7 8-7 13v2c0 5 3 10 7 13l2 2c4 3 6 8 5 13l-1 2c-1 5-5 9-10 10l-2 1c-5 1-9 5-10 10l-1 2c-1 5 1 10 5 13l2 2c4 3 6 8 5 13l-1 2c-1 5-5 8-10 9l-2 1c-5 1-9 6-9 11v2c0 5 4 9 9 11l2 1c5 1 9 4 10 9l1 2c1 5-1 10-5 13l-2 2c-4 3-6 8-5 13l1 2c1 5 5 8 10 9l2 1c5 1 8 6 8 11v2c0 5-3 10-8 12l-2 1c-5 2-8 7-8 12v2c0 5 3 9 8 11l2 1c5 2 8 7 7 12l-1 2c-1 5-6 9-11 10l-2 1c-5 1-10 5-11 11l-1 2c-1 6 2 11 7 14l2 2c5 3 7 9 6 14l-1 3c-1 5-6 9-11 10l-3 1c-5 1-10 6-10 12v2c0 6 4 11 10 13l3 1c5 2 9 7 9 12v3c0 5-4 10-9 12l-3 1c-5 2-9 7-9 13v2c0 6 4 11 9 13l3 1c5 2 8 7 8 12v3c0 5-3 10-8 12l-3 1c-5 2-9 7-8 13l1 2c1 6 6 10 12 11l3 1c6 1 11 6 12 12l1 3c1 6-2 12-7 15l-3 2c-5 3-8 9-8 15v3c0 6 3 11 8 14l3 2c5 3 8 9 7 15l-1 3c-1 6-6 11-12 12l-3 1c-6 1-11 6-12 12l-1 3c-1 6 2 12 8 15l3 2c6 3 9 10 8 16l-1 3c-1 6-7 11-13 12l-3 1c-6 1-12 6-13 13l-1 3c-1 7 3 13 9 16l3 2c6 3 10 10 9 17l-1 3c-1 7-7 12-14 13l-3 1c-7 1-13 7-14 14l-1 3c-1 7 3 14 9 17l3 2c6 3 10 11 9 18l-1 3c-1 7-8 12-15 13l-3 1c-7 1-13 7-14 15l-1 3c-1 8 3 15 10 18l3 2c7 3 11 11 10 19l-1 4c-1 8-8 13-16 14l-4 1c-8 1-14 8-15 16l-1 4c-1 8 4 16 11 19l4 2c8 3 12 12 11 20l-1 4c-1 8-9 14-17 15l-4 1c-8 1-15 8-16 16l-1 4c-1 9 4 17 12 20l4 2c8 3 13 12 12 21l-1 4c-1 9-9 15-18 16l-4 1c-9 1-16 9-17 18l-1 4c-1 9 5 18 13 21l4 2c9 3 14 13 13 22l-1 4c-1 9-10 16-19 17l-4 1c-9 1-17 9-18 18l-1 4c-1 10 5 19 14 22l4 2c9 4 15 14 14 23l-1 5c-1 9-11 16-20 17l-5 1c-9 1-18 10-19 19l-1 5c-1 10 6 20 15 23l5 2c10 4 16 15 15 25l-1 5c-1 10-11 17-21 18l-5 1c-10 1-19 10-20 20l-1 5c-1 11 6 21 16 24l5 2c10 4 17 15 16 26l-1 5c-1 10-12 18-22 19l-5 1c-10 1-20 11-21 21l-1 5c-1 11 7 22 17 25l5 2c11 4 18 16 17 27l-1 5c-1 11-12 19-23 20l-5 1c-11 1-21 11-22 22l-1 5c-1 12 7 23 18 26l5 2c11 4 19 17 18 28l-1 6c-1 11-13 20-24 21l-6 1c-11 1-22 12-23 23l-1 6c-1 12 8 24 19 27l6 2c12 4 20 17 19 29l-1 6c-1 12-14 21-25 22l-6 1c-12 1-23 12-24 24l-1 6c-1 13 8 25 20 28l6 2c12 4 21 18 20 30l-1 6c-1 12-14 22-26 23l-6 1c-12 1-24 13-25 25l-1 6c-1 13 9 26 21 29l6 2c13 4 22 19 21 31l-1 6c-1 13-15 23-27 24l-6 1c-13 1-25 13-26 26l-1 6c-1 14 9 27 22 30l6 2c13 4 23 20 22 32l-1 7c-1 13-16 24-28 25l-7 1c-13 1-26 14-27 27l-1 7c-1 14 10 28 23 31l7 2c14 4 24 20 23 33l-1 7c-1 14-16 25-29 26l-7 1c-14 1-27 14-28 28l-1 7c-1 15 10 29 24 32l7 2c14 4 25 21 24 34l-1 7c-1 14-17 26-30 27l-7 1c-14 1-28 15-29 29l-1 7c-1 15 11 30 25 33l7 2c15 4 26 22 25 35l-1 7c-1 15-18 27-31 28l-7 1c-15 1-29 15-30 30l-1 7c-1 16 11 31 26 34l7 2c15 4 27 23 26 36l-1 8c-1 15-18 28-32 29l-8 1c-15 1-30 16-31 31l-1 8c-1 16 12 32 27 35l8 2c16 4 28 23 27 37l-1 8c-1 16-19 29-33 30l-8 1c-16 1-31 16-32 32l-1 8c-1 17 12 33 28 36l8 2c16 4 29 24 28 38l-1 8c-1 16-20 30-34 31l-8 1c-16 1-32 17-33 33l-1 8c-1 17 13 34 29 37l8 2c17 4 30 25 29 39l-1 9c-1 17-21 31-35 32l-9 1c-17 1-33 17-34 34l-1 9c-1 18 13 35 30 38l9 2c17 4 31 26 30 40l-1 9c-1 17-22 32-36 33l-9 1c-17 1-34 18-35 35l-1 9c-1 18 14 36 31 39l9 2c18 4 32 26 31 41l-1 9c-1 18-22 33-37 34l-9 1c-18 1-35 18-36 36l-1 9c-1 19 14 37 32 40l9 2c18 4 33 27 32 42l-1 10c-1 18-23 34-38 35l-10 1c-18 1-36 19-37 37l-1 10c-1 19 15 38 33 41l10 2c19 4 34 28 33 43l-1 10c-1 19-24 35-39 36l-10 1c-19 1-37 19-38 38l-1 10c-1 20 15 39 34 42l10 2c19 4 35 29 34 44l-1 10c-1 19-25 36-40 37l-10 1c-19 1-38 20-39 39l-1 10c-1 20 16 40 35 43l10 2c20 4 36 30 35 45l-1 11c-1 20-26 37-41 38l-11 1c-20 1-39 20-40 40l-1 11c-1 21 16 41 36 44l11 2c20 4 37 31 36 46l-1 11c-1 20-27 38-42 39l-11 1c-20 1-40 21-41 41l-1 11c-1 21 17 42 37 45l11 2c21 4 38 32 37 47l-1 11c-1 21-28 39-43 40l-11 1c-21 1-41 21-42 42l-1 11c-1 22 17 43 38 46l11 2c21 4 39 33 38 48l-1 12c-1 21-29 40-44 41l-12 1c-21 1-42 22-43 43l-1 12c-1 22 18 44 39 47l12 2c22 4 40 34 39 49l-1 12c-1 22-30 41-45 42l-12 1c-22 1-43 22-44 44l-1 12c-1 23 18 45 40 48l12 2c22 4 41 35 40 50l-1 12c-1 22-31 42-46 43l-12 1c-22 1-44 23-45 45l-1 12c-1 23 19 46 41 49l12 2c23 4 42 36 41 51l-1 13c-1 23-32 43-47 44l-13 1c-23 1-45 23-46 46l-1 13c-1 24 19 47 42 50l13 2c23 4 43 37 42 52l-1 13c-1 23-33 44-48 45l-13 1c-23 1-46 24-47 47l-1 13c-1 24 20 48 43 51l13 2c24 4 44 38 43 53l-1 13c-1 24-34 45-49 46l-13 1c-24 1-47 24-48 48l-1 13c-1 25 20 49 44 52l13 2c24 4 45 39 44 54l-1 14c-1 24-35 46-50 47l-14 1c-24 1-48 25-49 49l-1 14c-1 25 21 50 45 53l14 2c25 4 46 40 45 55l-1 14c-1 25-36 47-51 48l-14 1c-25 1-49 25-50 50l-1 14c-1 26 21 51 46 54l14 2c25 4 47 41 46 56l-1 14c-1 25-37 48-52 49l-14 1c-25 1-50 26-51 51l-1 14c-1 26 22 52 47 55l14 2c26 4 48 42 47 57l-1 15c-1 26-38 49-53 50l-15 1c-26 1-51 26-52 52l-1 15c-1 27 22 53 48 56l15 2c26 4 49 43 48 58l-1 15c-1 26-39 50-54 51l-15 1c-26 1-52 27-53 53l-1 15c-1 27 23 54 49 57l15 2c27 4 50 44 49 59l-1 15c-1 27-40 51-55 52l-15 1c-27 1-53 27-54 54l-1 15c-1 28 23 55 50 58l15 2c27 4 51 45 50 60l-1 16c-1 27-41 52-56 53l-16 1c-27 1-54 28-55 55l-1 16c-1 28 24 56 51 59l16 2c28 4 52 46 51 61l-1 16c-1 28-42 53-57 54l-16 1c-28 1-55 28-56 56l-1 16c-1 29 24 57 52 60l16 2c28 4 53 47 52 62l-1 16c-1 28-43 54-58 55l-16 1c-28 1-56 29-57 57l-1 16c-1 29 25 58 53 61l16 2c29 4 54 48 53 63l-1 17c-1 29-44 55-59 56l-17 1c-29 1-57 29-58 58l-1 17c-1 30 25 59 54 62l17 2c29 4 55 49 54 64l-1 17c-1 29-45 56-60 57l-17 1c-29 1-58 30-59 59l-1 17c-1 30 26 60 55 63l17 2c30 4 56 50 55 65l-1 17c-1 30-46 57-61 58l-17 1c-30 1-59 30-60 60l-1 17c-1 31 26 61 56 64l17 2c30 4 57 51 56 66l-1 18c-1 30-47 58-62 59l-18 1c-30 1-60 31-61 61l-1 18c-1 31 27 62 57 65l18 2c31 4 58 52 57 67l-1 18c-1 31-48 59-63 60l-18 1c-31 1-61 31-62 62l-1 18c-1 32 27 63 58 66l18 2c31 4 59 53 58 68l-1 18c-1 31-49 60-64 61l-18 1c-31 1-62 32-63 63l-1 18c-1 32 28 64 59 67l18 2c32 4 60 54 59 69l-1 19c-1 32-50 61-65 62l-19 1c-32 1-63 32-64 64l-1 19c-1 33 28 65 60 68l19 2c32 4 61 55 60 70l-1 19c-1 32-51 62-66 63l-19 1c-32 1-64 33-65 65l-1 19c-1 33 29 66 61 69l19 2c33 4 62 56 61 71l-1 19c-1 33-52 63-67 64l-19 1c-33 1-65 33-66 66l-1 19c-1 34 29 67 62 70l19 2c33 4 63 57 62 72l-1 20c-1 33-53 64-68 65l-20 1c-33 1-66 34-67 67l-1 20c-1 34 30 68 63 71l20 2c34 4 64 58 63 73l-1 20c-1 34-54 65-69 66l-20 1c-34 1-67 34-68 68l-1 20c-1 35 30 69 64 72l20 2c34 4 65 59 64 74l-1 20c-1 34-55 66-70 67l-20 1c-34 1-68 35-69 69l-1 20c-1 35 31 70 65 73l20 2c35 4 66 60 65 75l-1 21c-1 35-56 67-71 68l-21 1c-35 1-69 35-70 70l-1 21c-1 36 31 71 66 74l21 2c35 4 67 61 66 76l-1 21c-1 35-57 68-72 69l-21 1c-35 1-70 36-71 71l-1 21c-1 36 32 72 67 75l21 2c36 4 68 62 67 77l-1 21c-1 36-58 69-73 70l-21 1c-36 1-71 36-72 72l-1 21c-1 37 32 73 68 76l21 2c36 4 69 63 68 78l-1 22c-1 36-59 70-74 71l-22 1c-36 1-72 37-73 73l-1 22c-1 37 33 74 69 77l22 2c37 4 70 64 69 79l-1 22c-1 37-60 71-75 72l-22 1c-37 1-73 37-74 74l-1 22c-1 38 33 75 70 78l22 2c37 4 71 65 70 80l-1 22c-1 37-61 72-76 73l-22 1c-37 1-74 38-75 75l-1 22c-1 38 34 76 71 79l22 2c38 4 72 66 71 81l-1 23c-1 38-62 73-77 74l-23 1c-38 1-75 38-76 76l-1 23c-1 39 34 77 72 80l23 2c38 4 73 67 72 82l-1 23c-1 38-63 74-78 75l-23 1c-38 1-76 39-77 77l-1 23c-1 39 35 78 73 81l23 2c39 4 74 68 73 83l-1 23c-1 39-64 75-79 76l-23 1c-39 1-77 39-78 78l-1 23c-1 40 35 79 74 82l23 2c39 4 75 69 74 84l-1 24c-1 39-65 76-80 77l-24 1c-39 1-78 40-79 79l-1 24c-1 40 36 80 75 83l24 2c40 4 76 70 75 85l-1 24c-1 40-66 77-81 78l-24 1c-40 1-79 40-80 80l-1 24"
              fill="currentColor" 
              className="text-green-500"
              style={{ clipPath: 'inset(0 100% 0 0)' }}
            />
          </svg>
          
          {/* Progress Stats */}
          <div className="mt-4 text-center">
            <div className="border-primary rounded border px-6 py-2 inline-block">
              <h3 className="text-2xl font-semibold">
                <span className="mileCount">{formatDistance(visualProgress?.distance || totalPoints)}</span>
                <small className="text-xs font-normal ml-1">miles</small>
              </h3>
              <h4 className="text-xs">
                of <span className="text-base">{formatDistance(goal)}</span> miles
              </h4>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}